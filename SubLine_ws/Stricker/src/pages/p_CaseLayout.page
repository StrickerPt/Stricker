<apex:page standardController="Case" extensions="c_CaseLayout">
    <apex:slds />
    <apex:includeScript value="/support/console/43.0/integration.js"/>
    <apex:includeScript value="{!URLFOR($Resource.bs, '/jQuery_2_0_3.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.swal2, '/sweetalert2.min.js')}"/>
    <style>
        .reduceFont{
        font-size: .65rem !important;
        }
        .swal-icon{
        box-sizing: content-box !important;
        }
        .swal-styled{
        background-image: inherit;
        }
        .swal-container {
        z-index: 9001;
        }
        .swal-button {
        background-image: inherit;
        font-size: 14px !important;
        }
        .slds-scope .slds-table th, .slds-scope .slds-table td {
        vertical-align: middle;
        }
        .dateFormat{
        display:none;
        }
        .datePicker {
        z-index: 9999;/*Changed this css property which was 100 prior*/
        position: fixed
        }
        .slds-scope .slds-table_cell-buffer tr>th:last-child, .slds-scope .slds-table_cell-buffer tr>td:last-child, .slds-scope .slds-table--cell-buffer tr>th:last-child, .slds-scope .slds-table--cell-buffer tr>td:last-child {
        padding-right: 0.25rem;
        padding-left: 0.25rem;
        }
        .slds-scope .slds-table_cell-buffer tr>th:first-child, .slds-scope .slds-table_cell-buffer tr>td:first-child, .slds-scope .slds-table--cell-buffer tr>th:first-child, .slds-scope .slds-table--cell-buffer tr>td:first-child {
        padding-left: 0.2rem;
        }
        textarea::-webkit-input-placeholder {
        font-size: .65rem;
        }
    </style>
    <script>
    function setTabTitle() {
        sforce.console.getFocusedSubtabId(function(result) {
            sforce.console.setTabTitle('{!Case.CaseNumber}', result.id);
            sforce.console.setTabIcon("{!URLFOR($Resource.caseIcon)}", result.id);//
        });
    }
    var setTabTitle = setTabTitle();
    function changeSection(ele, parEle){
        var classList = parEle.classList.value;
        if(classList.includes("slds-is-open")){
            parEle.classList.remove("slds-is-open");
        }else{
            parEle.classList.add("slds-is-open");
        }
        
    }
    function enterEditMode(){
        var editVars = document.getElementsByClassName("doEdit");
        var outputVars = document.getElementsByClassName("notEdit");
        
        for(var i = 0; i < editVars.length; i++){
            editVars[i].classList.remove("slds-hide");
            outputVars[i].classList.add("slds-hide");
        }
        
        var saveBtt = document.getElementById("saveBtt");
        saveBtt.classList.remove("slds-hide");
    }
    function exitEditMode(){
        var editVars = document.getElementsByClassName("doEdit");
        var outputVars = document.getElementsByClassName("notEdit");
        
        for(var i = 0; i < editVars.length; i++){
            editVars[i].classList.add("slds-hide");
            outputVars[i].classList.remove("slds-hide");
        }
        
        var saveBtt = document.getElementById("saveBtt");
        saveBtt.classList.add("slds-hide");
    }
    function spinnerOn(activated){
        if(activated){
            document.getElementById("spinner").style.display = "block";   
        }else{
            document.getElementById("spinner").style.display = "none";
        }
    }
    function openModal(modalToOpen){
        document.getElementById("backdrop").classList.add('slds-backdrop--open');
        document.getElementById(modalToOpen).classList.add('slds-fade-in-open');
    }
    function closeModal(modalToOpen){
        document.getElementById(modalToOpen).classList.remove('slds-fade-in-open');
        document.getElementById("backdrop").classList.remove('slds-backdrop--open');
    }
    function showList(eleId){
        var ele = document.getElementById(eleId);
        ele.classList.add("slds-is-open");
    }
    
    function hideList(eleId){
        var ele = document.getElementById(eleId);
        ele.classList.remove("slds-is-open");
    }
    
    
    var j$ = jQuery.noConflict();
    function renderContact(){
        var imageURL = "{!URLFOR($Asset.SLDS , '/assets/icons/standard-sprite/svg/symbols.svg#contact')}";
        var SVG = j$('<svg/>', {
            class: 'slds-icon slds-icon_small',
        });
        var SVGUse = j$('<use/>');
        SVGUse.attr('xlink:href',imageURL);
        
        var eles = document.getElementsByClassName("contactIcon");
        for(var i = 0; i < eles.length; i++){
            var aux ="#"+eles[i].id;
            j$(aux).html("");
            j$(aux).prepend(SVG.append(SVGUse));
            j$(aux).html(j$(aux).html());
        }
    }
    function renderUser(){
        var imageURL = "{!URLFOR($Asset.SLDS , '/assets/icons/standard-sprite/svg/symbols.svg#user')}";
        var SVG = j$('<svg/>', {
            class: 'slds-icon slds-icon_small',
        });
        var SVGUse = j$('<use/>');
        SVGUse.attr('xlink:href',imageURL);
        
        var eles = document.getElementsByClassName("dirIcon");
        for(var i = 0; i < eles.length; i++){
            var aux ="#"+eles[i].id;
            j$(aux).html("");
            j$(aux).prepend(SVG.append(SVGUse));
            j$(aux).html(j$(aux).html());
        }
    }
    function renderChevrons(){
        var imageURL = "{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevronright')}";
        var SVG = j$('<svg/>', {
            class: 'slds-section__title-action-icon slds-button__icon',
        });
        var SVGUse = j$('<use/>');
        SVGUse.attr('xlink:href',imageURL);
        
        var eles = document.getElementsByClassName("chevronIcon");
        for(var i = 0; i < eles.length; i++){
            SVGUse.attr('id',"icon" + eles[i].getAttribute("thisLine"));
            var aux ="#"+eles[i].id;
            j$(aux).html("");
            j$(aux).prepend(SVG.append(SVGUse));
            j$(aux).html(j$(aux).html());
        }
    }
    
    function buildPicklistValues(){
        if({!caso.status == 'Aberta' || isAllowed}){
            
            buildPicklist("sub");
            
            buildPicklist("action");
            
            buildPicklist("origin");
            
        }
        hideExtraInfos();
        showExtraInfo();
        spinnerOn(false);
    }
    function buildPicklist(name){
        var hiddenLists = document.getElementsByClassName(name + "PicklistHidden");
        var hasPicklistFilled = false;
        for(var i = 0; i < hiddenLists.length; i++){
            //div do inputField
            var divEle = hiddenLists[i];
            
            //select do inputField
            var thisEle = hiddenLists[i].children[0].children[0];

            //select que tenho de construir
            var buildEle = document.getElementsByClassName(name + divEle.getAttribute("thisLine"));
            
            //apaga todos os elementos da lista do select a construir
            var aux = buildEle[0].children.length;

            var cyclesDone = 0;
            for (var u = 1; u < aux; u++) {
                
                buildEle[0].removeChild(buildEle[0].children[u-cyclesDone]);
                cyclesDone++;
            }
            

            if(thisEle.children.length == 1){

                buildEle[0].setAttribute("disabled","true");
                buildEle[0].children[0].selected = 'selected';
            }else{

                hasPicklistFilled = true;
                buildEle[0].removeAttribute("disabled");
                for(var o = 1; o < thisEle.children.length; o++){
                    var opt = thisEle.children[o].cloneNode();
                    opt.innerHTML = thisEle.children[o].innerHTML;
                    buildEle[0].appendChild(opt);
                }
                if(thisEle.value == ""){
                    buildEle[0].children[0].selected = 'selected';
                }else{
                    buildEle[0].value = thisEle.value;
                }
            }
        }
        
        var headers = document.getElementsByClassName(name + "Header");
        
        var cells = document.getElementsByClassName(name + "Cell");
        
        if(!hasPicklistFilled){
            //esconder coluna   
            
            for(var h = 0; h < headers.length; h++){
                headers[h].classList.add("slds-hide");
            }
            for(var c = 0; c < cells.length; c++){
                cells[c].classList.add("slds-hide");
            }
        }else{
            //mostrar coluna   
            
            for(var h = 0; h < headers.length; h++){
                headers[h].classList.remove("slds-hide");
            }
            for(var c = 0; c < cells.length; c++){
                cells[c].classList.remove("slds-hide");
            }
        }
    }
    var map = {"Referência rececionada errada": ["ImpTer", "DataRec"],
               "Quantidade rececionada errada": ["ImpTer", "DataRec"],
               "Qualidade de impressão": ["ImpTer", "DataRec"],
               "Handling errado ou incompleto": ["ImpTer", "DataRec"],
               "Qualidade do produto": ["ImpTer", "DataRec"],
               "Transporte – Atraso": ["DataRec"],
               "Transporte – Mercadoria danificada": ["ImpTer", "DataRec"],
               "Transporte – Mercadoria extraviada": ["ImpTer"],
               "Erro de preço submetido": ["PrecInc"],
               "Erro no IVA": ["IvaInc"],
               "Erro na morada de entrega":  ["Mor", "DataRec"],
               "Atraso no envio da mercadoria": ["ImpTer", "DataRec"],
              };
    function showExtraInfo(){
        
        var isToShow = false;
        var celsTd = document.getElementsByClassName("extraInfoLine");

        for(var i = 0; i < celsTd.length; i++){
            
            var aux = celsTd[i].getAttribute("thisLine");
            var picklist = document.getElementsByClassName(aux+"tipo")[0];
            
            if(picklist.value in map){
                for(var u = 0; u < map[picklist.value].length; u++){
                    
                    //aux+map[picklist.value][u] => mostra o painel correcto
                    var divShow = document.getElementsByClassName(aux+map[picklist.value][u])[0];
                    divShow.classList.remove('slds-hide');
                    
                }
                isToShow = true;
            }else if(picklist.innerHTML in map){
                for(var u = 0; u < map[picklist.innerHTML].length; u++){
                    
                    //aux+map[picklist.value][u] => mostra o painel correcto
                    var divShow = document.getElementsByClassName(aux+map[picklist.innerHTML][u])[0];
                    divShow.classList.remove('slds-hide');
                    
                }
                isToShow = true;
            }
        }
        
        if(isToShow){
            var header = document.getElementsByClassName("infoHeader")[0];
            header.classList.remove('slds-hide');
            
            for(var i = 0; i < celsTd.length; i++){
                celsTd[i].classList.remove('slds-hide');
            }
        }
    }
    function hideExtraInfos(){
        var header = document.getElementsByClassName("infoHeader")[0];
        var celsTd = document.getElementsByClassName("extraInfoLine");
        //mostra cabeçalho
        
        header.classList.add('slds-hide');
        
        //mostra todas as celulas
        for(var i = 0; i < celsTd.length; i++){
            
            celsTd[i].classList.add('slds-hide');
        }
        
        var panels = document.getElementsByClassName("extraPanels");
        
        for(var i = 0; i < panels.length; i++){
            panels[i].classList.add('slds-hide');
        }
    }
    
    
    function showTab(ele){
        var actives = document.getElementsByClassName("slds-is-active");
        for(var i = 0; i < actives.length; i++){
            actives[i].classList.remove("slds-is-active");
        }
        
        var activeHeader = document.getElementById(ele.parentElement.id).classList.add("slds-is-active");
        
        var actives2 = document.getElementsByClassName("slds-show");
        for(var i = 0; i < actives2.length; i++){
            var a = actives2[i];
            a.classList.remove("slds-show");
            a.classList.add('slds-hide');
        }
        
        var toActivate = document.getElementById(ele.getAttribute("aria-controls"));
        
        toActivate.classList.add('slds-show');
        toActivate.classList.remove('slds-hide');
        setCookie();
    }
    function buildList(){
        var ele = document.getElementsByClassName("departHidden");
        var div = document.getElementById("buildListDiv");
        console.log(ele[0].children.length);
        if(ele[0].children.length > 1){
            for(var i = 1 ; i < ele[0].children.length; i++){
                var auxDisabled;
                if(div.getAttribute("existingDeps").includes(ele[0].children[i].value)){
                    var auxDisabled = " disabled ";
                }else{
                    auxDisabled = "";   
                }
                var label = ele[0].children[i].innerHTML;
                var value = ele[0].children[i].value;
                div.innerHTML += "<p><span class=\"slds-checkbox\"><input class=\"departInput\" type=\"checkbox\"" + auxDisabled + " id=\"" + 
                    value + "\"/><label class=\"slds-checkbox__label\" for=\"" + value + "\"><span class=\"slds-checkbox--faux slds-m-right--small\"></span>" + label + 
                    "</label></span></p>";
            }
        }else{
             div.innerHTML += "{!$Label.Sem_pedidos_de_parecer_disponiveis}";
        }
        
    }
    function criarParecerJS(){
        var inputs = document.getElementsByClassName("departInput");
        var aux = "";
        for(var i = 0; i < inputs.length; i++){
            if(inputs[i].checked){
                if(aux != "") aux += ";";
                aux += inputs[i].id;
            }
        }
        if(aux != "") criarParecerServer(aux);
        else{
            spinnerOn(false);
            closeModal("createOpinion");
        }
    }
    //************************************************************************METODOS DE FICHEIROS
    var filesMap= [];
    //File handle functions
    function readFile(uniqueId){
        var file = document.querySelector('input[type=file]').files[0];
        if(file != null){
            if(check_extension(file.name)){
                if(file.size < 6291456){
                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.addEventListener("load", function () {
                        
                        //insere ficheiro na estrutura
                        if(!(uniqueId in filesMap)) filesMap[uniqueId] = [];
                        var auxList = filesMap[uniqueId];
                        
                        var re = /\..+$/;
                        var ext = file.name.match(re)[0];
                        
                        auxList.push({body: reader.result, name : file.name, extension : ext});
                        filesMap[uniqueId] = auxList;
                        console.log(uniqueId);
                        buildFileDiv(auxList.length, uniqueId);
                        buildFilesTable();
                    }, false);
                }else{
                    swal('{!$Label.Erro}','{!$Label.Tamanho_de_ficheiro_excedido}','error');
                }
            }else{
                swal('{!$Label.Erro}','{!$Label.Ficheiro_invalido}','error');
            }
        }
    }
    
    function buildTableHeader(){
        var table = j$("<thead/>", {});
        var tr = j$("<tr/>", {});
        var th1 = j$("<th>{!$Label.Nome}</th>");
        var th2 = j$("<th>{!$Label.Extensao}</th>");
        var th3 = j$("<th>{!$Label.Apagar}</th>");
        tr.append(th1);
        tr.append(th2);
        tr.append(th3);
        
        return table.append(tr);
    }
    
    function buildFileDiv(size, uniqueId){
        
        var auxString = size + "";
        if(size == 1) auxString +=  " {!$Label.Ficheiro}";
        else auxString +=  " {!$Label.Ficheiros}";
        var auxDiv = document.getElementById("auxDiv" + uniqueId);
        console.log(uniqueId);
        if(size == 0) {
            auxDiv.classList.add("slds-hide");
        }else{
            auxDiv.classList.remove("slds-hide");
        }
        auxDiv.innerHTML = "<span class=\"slds-badge\">" + auxString + "</span>";
    }
    var hash = {
        ".pdf" : 1,
        ".jpg" : 1,
        ".png" : 1,
        ".gif" : 1,
        ".mp4" : 1,
        ".mov" : 1,
        ".flv" : 1,
        ".avi" : 1,
        ".xls" : 1,
        ".xlsx" : 1,
        ".csv" : 1,
        ".docx" : 1,
        ".doc" : 1,
    };
    function check_extension(filename) {
        var re = /\..+$/;
        var ext = filename.match(re);
        
        if (hash[ext[0].toLowerCase()]) {
            return true;
        } else {
            return false;
        }
    }
    
    function removeFileFromMap(index, uniqueId){
        if(uniqueId in filesMap){
            filesMap[uniqueId].splice(index, 1);
        }
        buildFileDiv(filesMap[uniqueId].length, uniqueId);
        buildFilesTable();
    }
    
    function saveFiles(){
        for(var key in filesMap){
            for(var i = 0; i < filesMap[key].length; i++){
                newFile(filesMap[key][i].body,key,filesMap[key][i].name);
            }
        }
    }
    
    function confirmaAutorizar(){
        swal({
            title: "{!$Label.Tem_a_certeza}",
            text: "_Irá enviar a reclamação para a direcção comercial",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
        .then((willSend) => {
            if (willSend) {
            	spinnerOn(true);
            	autorizarServer();
        	}
        });
    }
    function responderPedidosJS(){
        var radios = document.getElementsByClassName("radioResposta");
        var selectedRadio = "";
        for(var i = 0; i < radios.length ; i++){
            if(radios[i].checked){
                selectedRadio = radios[i].value;
            }
        }
        
        responderPedidoServer(selectedRadio);
    }
    
    function openTab(objId){
        if(sforce.console.isInConsole()){
            var openSubTab = function openSubTab(result) {
                sforce.console.openSubtab(result.id, objId, true);
            };
            sforce.console.getFocusedPrimaryTabId(openSubTab);
        }else{
            window.open("/" +objId ,"_blank");
        }
    }
    function renderDel(){
        var imageURL = "{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#delete')}";
        var SVG = j$('<svg/>', {
            class: 'slds-icon slds-icon-text-default',
            style: "width: 15px;height:15px;",
        });
        var SVGUse = j$('<use/>');
        SVGUse.attr('xlink:href',imageURL);
        
        var eles = document.getElementsByClassName("deleteIcon");
        for(var i = 0; i < eles.length; i++){
            var aux ="#"+eles[i].id;
            eles[i].classList.add("slds-input", "slds-button--neutral");
            eles[i].style = "width: auto;padding-right:  0.5rem;;padding-left: 0.5rem;height: 32px;vertical-align: bottom;cursor:pointer;";
            j$(aux).prepend(SVG.append(SVGUse));
            j$(aux).html(j$(aux).html());
        }
    }
    
    function validarAcoes(){
        var eles = document.getElementsByClassName("actionField");
        var valid = true;
        for(var i = 0; i < eles.length; i++){

            var name = eles[i].getAttribute("matchEle");
            var matchValue = document.getElementsByClassName(name)[0].children[0].children[0].value;
            
            //console.log(matchValue);
            
            if(matchValue == ""){
                valid = false;
                break;
            }
        }
        
        if(valid){
            //avancar
            hideAlert();
            
            closeModal("linhas");
            dummyTratamento();
            //enviarParaTratamento();
        }else{
            showAlert("Por favor preencher todas as acoes correctivas.");
            spinnerOn(false);
        }
    }
    function showAlert(message){
        var divAlert = document.getElementById("alertasErros");
        var mensagem = document.getElementById("alertasErrosMensagem");
        var startP = "<p>";
        var endP = "</p>";
        divAlert.classList.remove("slds-hide");
        
        mensagem.innerHTML = message;
    }
    
    
    function hideAlert(){
        var divAlert = document.getElementById("alertasErros");
        if(divAlert != null) divAlert.classList.add("slds-hide");
    }
    function calcValCred(linhaId, qtt, preco, precoOrigin){
        var valCred = document.getElementsByClassName("valor_creditar"+linhaId)[0];
        if(valCred != null){
            var val;
            if(preco != ""){
                if(preco.toString().includes(",")) preco = parseFloat(preco.toString().replaceAll(",", "."));
                val = (qtt*precoOrigin) - (qtt * preco);
                
                if(val > 0){
                    val = roundNumber(val, 2);
                }else{
                    val = 0;  
                }
            }else{
                val = "";   
            }
            valCred.value = val.toString().replaceAll('.', ',');
        }
    }
    String.prototype.replaceAll = function(searchStr, replaceStr) {
        var str = this;
        
        // no match exists in string?
        if(str.indexOf(searchStr) === -1) {
            // return string
            return str;
        }
        
        // replace and remove first match, and do another recursirve search/replace
        return (str.replace(searchStr, replaceStr)).replaceAll(searchStr, replaceStr);
    }
    
    function roundNumber(num, scale) {
        if(!("" + num).includes("e")) {
            return +(Math.round(num + "e+" + scale)  + "e-" + scale);
        } else {
            var arr = ("" + num).split("e");
            var sig = ""
            if(+arr[1] + scale > 0) {
                sig = "+";
            }
            return +(Math.round(+arr[0] + "e" + sig + (+arr[1] + scale)) + "e-" + scale);
        }
    }
    
    function changeDiscount(linhaId, change){
        var percent = document.getElementsByClassName("percentDisc"+linhaId)[0];
        var flat = document.getElementsByClassName("flatDisc"+linhaId)[0];
        
        if(change == "percent"){
            flat.value = "";
            flat.classList.add("slds-hide");
            percent.classList.remove("slds-hide");
        }else if(change == "currency"){
            percent.value = "";
            percent.classList.add("slds-hide");
            flat.classList.remove("slds-hide");
        }
    }
    
    function fillDiscount(linhaId, percent, total){
        var flat = document.getElementsByClassName("flatDisc"+linhaId)[0];
        if(percent > 100) percent = 100;
        if(flat != null && percent > 0){
            flat.value = total*(percent/100);
        }
    }
    function calcAllPrecos(){
        var eles = document.getElementsByClassName("valor_creditar");
        
        for(var i = 0; i < eles.length; i++){
            eles[i].dispatchEvent(new KeyboardEvent('keyup',{'key':'a'}));
        }
        recalcTotal();
    }
    </script>
    <div class="slds-scope" xmlns:xlink="http://www.w3.org/1999/xlink">
        <apex:form >
            <apex:actionFunction name="gravarCaso" action="{!gravarCaso}" rerender="origem,listPanel, idPanel, contactNamePanel, owner, showCheckbox, simuladorPanel" oncomplete="exitEditMode();renderContact();renderUser();spinnerOn(false);"/>
            <apex:actionFunction name="gravarLinhasJS" action="{!gravarLinhas}" rerender="linesPanel, comLinePanel" oncomplete="renderDel();renderChevrons();closeModal('linhas');spinnerOn(false);"/>
            <apex:actionFunction name="dummyPicklist" action="{!dummy}" rerender="tabelaLinhas" oncomplete="buildPicklistValues();"/>
            <apex:actionFunction name="startOpenModal" action="{!findLine}" rerender="createOpinionModal" oncomplete="buildList();openModal('createOpinion');spinnerOn(false);">
                <apex:param assignTo="{!choosenLine}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="startOpenModalRecolha" action="{!dummy}" rerender="recolhaContent" oncomplete="openModal('modal_recolha');spinnerOn(false);">
                <apex:param assignTo="{!choosenLine}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="startOpenModalResposta" action="{!dummy}" rerender="respostaContent" oncomplete="openModal('modal_resposta');spinnerOn(false);">
                <apex:param assignTo="{!choosenLine}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="responderPedidoServer" action="{!actualizarLinha}" rerender="dummy" oncomplete="closeModal('modal_resposta');spinnerOn(false);">
                <apex:param assignTo="{!respostaPedidoFotos}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="responderRecolha" action="{!actualizarLinhaRecolha}" rerender="dummy" oncomplete="closeModal('modal_recolha');spinnerOn(false);"/>
            <apex:actionFunction name="criarParecerServer" action="{!criarParecer}" rerender="linesPanel" oncomplete="renderChevrons();closeModal('createOpinion');spinnerOn(false);">
                <apex:param assignTo="{!departs}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="chooseLine" action="{!dummy}" reRender="filesModalContent" oncomplete="spinnerOn(false);closeModal('linhas');openModal('filesModal');buildFilesTable();">
                <apex:param assignTo="{!lineUniqueId}" name="p1" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="newFile" action="{!newFile}" reRender="dummy" oncomplete="spinnerOn(false);">
                <apex:param assignTo="{!blobFile}" name="p1" value=""/>
                <apex:param assignTo="{!lineUniqueId}" name="p2" value=""/>
                <apex:param assignTo="{!fileName}" name="p3" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="autorizarServer" action="{!autorizarClaim}" rerender="autorizarPanel" oncomplete="checkAutorizarSucess();"/>
            <apex:actionFunction name="enviarParaTratamento" action="{!null}" rerender="dummy" oncomplete=""/>
            <apex:actionFunction name="dummyTratamento" action="{!dummy}" rerender="editPanel,tratamentoContent,panelTotal" oncomplete="spinnerOn(false);openModal('modal_enviaTratamento');calcAllPrecos();">
            	<apex:param assignTo="{!showTratamento}" name="p1" value="{!!showTratamento}"/>
            </apex:actionFunction>
            <apex:actionFunction name="recalcTotal" action="{!dummy}" rerender="panelTotal" oncomplete="spinnerOn(false);"/>
            <apex:outputPanel id="autorizarPanel">
            	<script>
                function checkAutorizarSucess(){
                    spinnerOn(false);
                    if({!sucess}){
                        swal("_Reclamação enviada para a direcção.")
                        .then((willSend) => {
                            console.log("asasd");
                            location.reload();
                              });
                    }else{
                        swal("", "{!errorMsg}", "error");
                    }
                }
                </script>
            </apex:outputPanel>
            <fieldset class="slds-form--compound">
                <div class="slds-form-element__group ">
                    <c:cmp_ClaimsHeader title="{!Case.Account.Name}" subTitle="{!$ObjectType.Case.label} {!Case.CaseNumber}" library="standard" symbol="case"/>
                    <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-around--small">
                            <a class="slds-button slds-button_neutral" onclick="confirmaAutorizar();">_Enviar para decisão</a>
                        </div>
                    </div> <div class="slds-form-element__row">
                    <div class="slds-form-element slds-p-around--small slds-size--1-of-1">
                        <c:cmp_CasePath case="{!Case.Id}"/>
                    </div>
                    </div>
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!--------------------------------------------------DETALHES------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <div class="slds-form-element__row">
                        <div class="slds-form-element slds-size_1-of-1">
                            <div class="slds-section slds-is-open">
                                <h3 class="slds-section__title">
                                    <a aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action" onclick="changeSection(this, this.parentElement.parentElement);">
                                        <span class="slds-truncate" style="width: 100%; text-align: left;">
                                            <div class="slds-icon_container slds-m-right--medium">
                                                <svg class="slds-section__title-action-icon slds-button__icon" aria-hidden="false">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#switch')}"></use>
                                                </svg>
                                            </div>
                                            _Detalhes da reclamação
                                        </span>
                                    </a>
                                </h3>
                                <div aria-hidden="true" class="slds-section__content" id="expando-unique-id">
                                    <div class="slds-form" role="list">
                                        <div class="slds-grid slds-gutters_small slds-hide" id="saveBtt">
                                            <div class="slds-col slds-has-flexi-truncate slds-align--absolute-center slds-p-vertical--xx-small" role="listitem">
                                                <div class="slds-form-element">
                                                    <a class="slds-button slds-button_destructive" onclick="exitEditMode();">{!$Label.Cancelar}</a>
                                                    <a class="slds-button slds-button_brand" onclick="gravarCaso();spinnerOn(true)">{!$Label.Gravar}</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Case.Fields.CaseNumber.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            {!Case.CaseNumber}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">_Responsável pela reclamação</span>
                                                    <apex:outputPanel rendered="{!!isAllowed}">
                                                        <div class="slds-form-element__control">
                                                            <span class="slds-form-element__static slds-border_bottom">
                                                                <a href="javascript:void(0);">{!caseOwner}</a>
                                                            </span>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!isAllowed}">
                                                        <div class="slds-form-element__control notEdit">
                                                            <span class="slds-form-element__static slds-border_bottom">
                                                                <apex:outputPanel id="owner">
                                                                    <a href="javascript:void(0);">{!caseOwner}</a>
                                                                </apex:outputPanel>
                                                            </span>
                                                            <a class="slds-button slds-button_icon" title="Edit: Description" onclick="enterEditMode();">
                                                                <svg class="slds-button__icon slds-button__icon_hint" aria-hidden="true">
                                                                    <use xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#edit')}"></use>
                                                                </svg>
                                                            </a>
                                                        </div>
                                                        <div class="slds-form-element__control doEdit slds-hide">
                                                            <div class="slds-combobox_container">
                                                                <apex:actionFunction name="callFilterDir" action="{!applyFilterDir}" reRender="dirListPanel, dirPanel" oncomplete="renderUser();"/>
                                                                <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" aria-expanded="false" aria-haspopup="listbox" role="combobox" id="dirCombobox">
                                                                    <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                                        <apex:inputText html-autocomplete="off" value="{!filterDir}" onfocus="showList('dirCombobox');" onkeyup="callFilterDir();" styleClass="slds-input slds-combobox__input" 
                                                                                        id="dirFilter" html-placeholder="Search..." />
                                                                        
                                                                        <apex:outputPanel id="dirPanel">
                                                                            <apex:inputHidden value="{!caso.OwnerId}" id="hiddenOwner"/>
                                                                        </apex:outputPanel>
                                                                        <span class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right">
                                                                            <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">
                                                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#search')}" />
                                                                            </svg>
                                                                        </span>
                                                                    </div>
                                                                    <apex:outputPanel id="dirListPanel">
                                                                        <apex:outputPanel rendered="{!filteredListDir.size > 0}">
                                                                            <div id="listbox-id-1" class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox">
                                                                                <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                                    <!-- REPEAT -->
                                                                                    <apex:repeat value="{!filteredListDir}" var="dir">
                                                                                        <li role="presentation" class="slds-listbox__item" 
                                                                                            onclick="document.getElementById('{!$Component.dirFilter}').value = '{!dir.Name}'; 
                                                                                                     document.getElementById('{!$Component.hiddenOwner}').value = '{!dir.Id}'; 
                                                                                                     hideList('dirCombobox');
                                                                                                     callFilterDir();">
                                                                                            <div id="option1" class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta" role="option">
                                                                                                <span class="slds-media__figure">
                                                                                                    <span class="slds-icon_container slds-icon-standard-contact dirIcon" id="dir{!dir.Id}">
                                                                                                        <!-- AQUI É CRIADO O BOTÃO COM O ICON renderUser() -->
                                                                                                    </span>
                                                                                                </span>
                                                                                                <span class="slds-media__body">
                                                                                                    <span class="slds-listbox__option-text slds-listbox__option-text_entity">{!dir.Name}</span>
                                                                                                    <span class="slds-listbox__option-meta slds-listbox__option-meta_entity">
                                                                                                        {!dir.Profile.Name}</span>
                                                                                                </span>
                                                                                            </div>
                                                                                        </li>
                                                                                    </apex:repeat>      
                                                                                </ul>
                                                                            </div>   
                                                                        </apex:outputPanel>                                       
                                                                    </apex:outputPanel>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </apex:outputPanel>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Account.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            {!Case.Account.Name}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Case.Fields.Status.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            {!Case.Status}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Case.Fields.Sub_estado__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            {!Case.Sub_estado__c}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Case.Fields.Origin.Label}</span>
                                                    <div class="slds-form-element__control notEdit">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <apex:outputPanel id="origem">
                                                                <apex:outputField value="{!caso.Origin}"/> 
                                                            </apex:outputPanel>
                                                        </span>
                                                        <a class="slds-button slds-button_icon" title="Edit: Description" onclick="enterEditMode();">
                                                            <svg class="slds-button__icon slds-button__icon_hint" aria-hidden="true">
                                                                <use xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#edit')}"></use>
                                                            </svg>
                                                        </a>
                                                    </div>
                                                    <div class="slds-form-element__control doEdit slds-hide">
                                                        <apex:inputField value="{!caso.Origin}" styleClass="slds-input slds-form-element__static"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.Contact.Fields.Name.Label}</span>
                                                    <div class="slds-form-element__control notEdit">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <apex:outputPanel id="contactNamePanel">
                                                                {!caseContact}&nbsp;
                                                            </apex:outputPanel>
                                                        </span>
                                                        <a class="slds-button slds-button_icon" title="Edit: Description" onclick="enterEditMode();">
                                                            <svg class="slds-button__icon slds-button__icon_hint" aria-hidden="true">
                                                                <use xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#edit')}"></use>
                                                            </svg>
                                                        </a>
                                                    </div>
                                                    <div class="slds-form-element__control doEdit slds-hide">
                                                        <div class="slds-combobox_container">
                                                            <apex:actionFunction name="callFilter" action="{!applyFilter}" reRender="listPanel, idPanel" oncomplete="renderContact();"/>
                                                            <div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" aria-expanded="false" aria-haspopup="listbox" role="combobox" id="combobox">
                                                                <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                                                                    <apex:inputText html-autocomplete="off" value="{!filter}" onfocus="showList('combobox');" onkeyup="callFilter();" styleClass="slds-input slds-combobox__input" 
                                                                                    id="contactFilter" html-placeholder="Search..." />
                                                                    
                                                                    <apex:outputPanel id="idPanel">
                                                                        <apex:inputHidden value="{!caso.ContactId}" id="hiddenNumCli"/>
                                                                    </apex:outputPanel>
                                                                    <span class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right">
                                                                        <svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">
                                                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#search')}" />
                                                                        </svg>
                                                                    </span>
                                                                </div>
                                                                <apex:outputPanel id="listPanel">
                                                                    <apex:outputPanel rendered="{!filteredList.size > 0}">
                                                                        <div id="listbox-id-1" class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox">
                                                                            <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                                <!-- REPEAT -->
                                                                                <apex:repeat value="{!filteredList}" var="contact">
                                                                                    <li role="presentation" class="slds-listbox__item" 
                                                                                        onclick="document.getElementById('{!$Component.contactFilter}').value = '{!contact.Name}'; 
                                                                                                 document.getElementById('{!$Component.hiddenNumCli}').value = '{!contact.Id}'; 
                                                                                                 hideList('combobox');
                                                                                                 callFilter();">
                                                                                        <div id="option1" class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta" role="option">
                                                                                            <span class="slds-media__figure">
                                                                                                <span class="slds-icon_container slds-icon-standard-contact contactIcon" id="contact{!contact.Id}">
                                                                                                    <!-- AQUI É CRIADO O BOTÃO COM O ICON -->
                                                                                                </span>
                                                                                            </span>
                                                                                            <span class="slds-media__body">
                                                                                                <span class="slds-listbox__option-text slds-listbox__option-text_entity">{!contact.Name}</span>
                                                                                                <span class="slds-listbox__option-meta slds-listbox__option-meta_entity">
                                                                                                    {!if(contact.Email != null, contact.Email + ';', '')}
                                                                                                    {!if(contact.Phone != null, contact.Phone + ';', '')}
                                                                                                    {!if(contact.MobilePhone != null, contact.MobilePhone + ';', '')}</span>
                                                                                            </span>
                                                                                        </div>
                                                                                    </li>
                                                                                </apex:repeat>      
                                                                            </ul>
                                                                        </div>   
                                                                    </apex:outputPanel>                                       
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <apex:outputPanel rendered="{!isAllowed}">
                                            <div class="slds-grid slds-gutters_small">
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <span class="slds-form-element__label">{!$ObjectType.Case.Fields.Cobrar_portes_ao_cliente__c.Label}</span>
                                                        <div class="slds-form-element__control notEdit">
                                                            <span class="slds-form-element__static slds-border_bottom">
                                                                <apex:outputPanel id="showCheckbox">
                                                                    <span class="slds-checkbox">
                                                                        
                                                                        <apex:inputCheckbox value="{!caso.Cobrar_portes_ao_cliente__c}" id="checkboxPortesNoEdit" disabled="true"/>
                                                                        <apex:outputLabel styleClass="slds-checkbox__label" for="checkboxPortesNoEdit">
                                                                            <span class="slds-checkbox--faux"></span>
                                                                        </apex:outputLabel>
                                                                    </span>
                                                                </apex:outputPanel>
                                                            </span>
                                                            <a class="slds-button slds-button_icon" title="Edit: Description" onclick="enterEditMode();">
                                                                <svg class="slds-button__icon slds-button__icon_hint" aria-hidden="true">
                                                                    <use xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#edit')}"></use>
                                                                </svg>
                                                            </a>
                                                        </div>
                                                        <div class="slds-form-element__control doEdit slds-hide">
                                                            <span class="slds-checkbox">
                                                                <apex:inputCheckbox value="{!caso.Cobrar_portes_ao_cliente__c}" id="checkboxPortesEdit"/>
                                                                <apex:outputLabel styleClass="slds-checkbox__label" for="checkboxPortesEdit">
                                                                    <span class="slds-checkbox--faux"></span>
                                                                </apex:outputLabel>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!---------------------------------------------------LINHAS-------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <div class="slds-form-element__row">
                        <div class="slds-form-element slds-size_1-of-1">
                            <div class="slds-section slds-is-open">
                                <h3 class="slds-section__title">
                                    <a aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action" onclick="changeSection(this, this.parentElement.parentElement);">
                                        <span class="slds-truncate" style="width: 100%; text-align: left;">
                                            <div class="slds-icon_container slds-m-right--medium">
                                                <svg class="slds-section__title-action-icon slds-button__icon" aria-hidden="false">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#switch')}"></use>
                                                </svg>
                                            </div>
                                            _Linhas reclamadas
                                        </span>
                                    </a>
                                </h3>
                                <div aria-hidden="true" class="slds-section__content" id="expando-unique-id">
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element">
                                            <a class="slds-button slds-button_neutral" onclick="dummyPicklist();openModal('linhas');">_Edit</a>
                                        </div>
                                    </div>
                                    <apex:outputPanel id="linesPanel">
                                        <div class="slds-form" role="list">
                                            <div class="slds-grid slds-gutters_small slds-size--1-of-1" style="background-color: rgb(250, 250, 249);color: rgb(81, 79, 77);padding: .25rem .5rem;">
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control slds-text-align--center">
                                                            {!$Label.Referencia}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            {!$Label.Quantidade_total}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            {!$Label.Quantidade}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            {!$ObjectType.OrderItem.fields.Tipologia__c.Label}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            {!$ObjectType.OrderItem.fields.Sub_tipologia__c.Label}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            {!$ObjectType.OrderItem.fields.Acao_corretiva__c.Label}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate {!if(isAllowed && caso.Status = 'Em análise', '' ,'slds-hide')}" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate {!if(hasRequest, '', 'slds-hide')}" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate {!if(hasRecolha, '', 'slds-hide')}" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <script>
                                            function changeThisLine(thisLine){
                                                var div = document.getElementById("line"+thisLine);
                                                var section = document.getElementById("section"+thisLine);
                                                var icon = document.getElementById("icon"+thisLine);
                                                if(section.classList.value.includes("slds-is-open")){
                                                    section.classList.remove("slds-is-open");
                                                    div.classList.add("slds-hide");
                                                    icon.setAttribute("xlink:href", "{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevronright')}");
                                                }else{
                                                    section.classList.add("slds-is-open");
                                                    div.classList.remove("slds-hide");
                                                    icon.setAttribute("xlink:href", "{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevrondown')}");
                                                }
                                            }
                                            </script>
                                            <!--div style="height:300px; overflow-y:auto;overflow-x:hidden;"-->
                                            <apex:repeat value="{!items}" var="linha">
                                                <div class="slds-grid slds-gutters_small slds-m-top--x-small slds-size--1-of-1">
                                                    
                                                    <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control slds-text-align--center">
                                                                <apex:outputPanel rendered="{!isAllowed}">
                                                                    <div class="slds-float--left slds-text-color--default chevronIcon" style="cursor:pointer;" thisLine="{!linha.Id}" onclick="changeThisLine('{!linha.Id}');"
                                                                         id="chevron{!linha.id}">
                                                                        <svg class="slds-section__title-action-icon slds-button__icon " aria-hidden="false">
                                                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" id="icon{!linha.Id}"
                                                                                 xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevronright')}"></use>
                                                                        </svg>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputField value="{!linha.Referencia_SKU__c}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <apex:outputField value="{!linha.Quantidade_original__c}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <apex:outputField value="{!linha.Quantidade_reclamada__c}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <apex:outputField value="{!linha.Tipologia__c}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate " role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <apex:outputField value="{!linha.Sub_tipologia__c}"/>&nbsp;
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <apex:outputField rendered="{!isAllowed}" value="{!linha.Acao_corretiva__c}"/>
                                                                <apex:outputField rendered="{!!isAllowed}" value="{!linha.Acao_corretiva_sugerida__c}"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate {!if(isAllowed && caso.Status = 'Em análise', '' ,'slds-hide')}" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control">
                                                                <a class="slds-button slds-button_neutral" onclick="spinnerOn(true);startOpenModal('{!linha.Id}');">Pedir parecer</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate {!if(hasRequest, '', 'slds-hide')}" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control ">
                                                                <apex:outputPanel rendered="{!mapaPedidos[linha.Id].fotos || mapaPedidos[linha.Id].recolha}">
                                                                    <a class="slds-button slds-button_neutral" style="white-space: nowrap;overflow: hidden;"
                                                                       onclick="spinnerOn(true);startOpenModalResposta('{!linha.Id}');">Responder pedido</a>
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col slds-has-flexi-truncate {!if(hasRecolha, '', 'slds-hide')}" role="listitem">
                                                        <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                            <div class="slds-form-element__control ">
                                                                <apex:outputPanel rendered="{!linha.Quantidade_a_recolher__c != null}">
                                                                    <a class="slds-button slds-button_neutral" style="white-space: nowrap;overflow: hidden;"
                                                                       onclick="spinnerOn(true);startOpenModalRecolha('{!linha.Id}');">Dados da recolha</a>
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <apex:outputPanel rendered="{!isAllowed}">
                                                    <div class="slds-grid slds-gutters_small slds-hide" id="line{!linha.Id}">
                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                            <div class="slds-section" id="section{!linha.Id}">
                                                                <div aria-hidden="true" class="slds-section__content slds-p-bottom--small" id="expando-unique-id">
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <apex:outputPanel rendered="{!linha.Acao_corretiva_sugerida__c != ''}">
                                                                                <div class="slds-text-title_caps slds-text-heading_small">{!$ObjectType.OrderItem.fields.Acao_corretiva_sugerida__c.Label}:</div>
                                                                                <apex:outputField value="{!linha.Acao_corretiva_sugerida__c}"/>
                                                                            </apex:outputPanel>
                                                                            <apex:outputPanel rendered="{!linha.Acao_corretiva_sugerida__c == ''}">
                                                                                <div class="slds-text-title">_Sem acão correctiva sugerida</div>
                                                                            </apex:outputPanel>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small slds-p-top--small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-text-heading_small">{!$ObjectType.Pedido_de_parecer__c.labelPlural}</div>
                                                                        </div>
                                                                    </div>
                                                                    <apex:repeat value="{!linha.Pedidos_de_parecer__r}" var="par">
                                                                        <div class="slds-grid slds-gutters_small">
                                                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                               <a onclick="openTab('{!par.Id}');"> <apex:outputField value="{!par.Departamento__c}"/> </a>
                                                                            </div>
                                                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                                <apex:outputField value="{!par.Estado__c}"/>
                                                                            </div>
                                                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                                <apex:outputPanel rendered="{!par.Resposta_final__c != null}">
                                                                                    <apex:outputField value="{!par.Resposta_final__c}"/>
                                                                                </apex:outputPanel>
                                                                                <apex:outputPanel rendered="{!par.Resposta_final__c = null}">
                                                                                    {!$Label.Sem_resposta}
                                                                                </apex:outputPanel>
                                                                            </div>
                                                                        </div>
                                                                    </apex:repeat>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>                                                    
                                                </apex:outputPanel>
                                            </apex:repeat>
                                            <!--/div-->
                                        </div>
                                    </apex:outputPanel>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!--------------------------------------------ALERTAS DA RECLAMACAO------------------------------------------------------------>
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <div class="slds-form-element__row">
                        <div class="slds-form-element slds-size_1-of-1">
                            <div class="slds-section">
                                <h3 class="slds-section__title">
                                    <a aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action" onclick="changeSection(this, this.parentElement.parentElement);">
                                        <span class="slds-truncate" style="width: 100%; text-align: left;">
                                            <div class="slds-icon_container slds-m-right--medium">
                                                <svg class="slds-section__title-action-icon slds-button__icon" aria-hidden="false">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#switch')}"></use>
                                                </svg>
                                            </div>
                                            _Alertas
                                        </span>
                                    </a>
                                </h3>
                                <div aria-hidden="true" class="slds-section__content" id="expando-unique-id">
                                    <div class="slds-form" role="list">
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(caso.Cliente_VIP__c  , 'slds-has-error', '')}">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <span class="slds-checkbox">
                                                                <apex:inputCheckbox value="{!caso.Cliente_VIP__c}" id="checkbox1" disabled="true"/>
                                                                <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox1">
                                                                    <span class="slds-checkbox--faux"></span>_Cliente VIP
                                                                </apex:outputLabel>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(caso.Cliente_com_encomendas_canceladas__c , 'slds-has-error', '')}">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <span class="slds-checkbox">
                                                                <apex:inputCheckbox value="{!caso.Cliente_com_encomendas_canceladas__c}" id="checkbox2" disabled="true"/>
                                                                <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox2">
                                                                    <span class="slds-checkbox--faux"></span>_Cliente com encomendas canceladas
                                                                </apex:outputLabel>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(caso.Cliente_com_divida_vencida__c , 'slds-has-error', '')}">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <span class="slds-checkbox">
                                                                <apex:inputCheckbox value="{!caso.Cliente_com_divida_vencida__c}" id="checkbox3" disabled="true"/>
                                                                <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox3">
                                                                    <span class="slds-checkbox--faux"></span>_Cliente com dívida vencida
                                                                </apex:outputLabel>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <span class="slds-checkbox">
                                                                _Número de dossiers do cliente sem reclamação: {!caso.N_dossiers_cliente_sem_reclamacao__c}
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(caso.Cliente_mais_de_3_reclamacoes__c , 'slds-has-error', '')}">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static slds-border_bottom">
                                                            <span class="slds-checkbox">
                                                                <apex:inputCheckbox value="{!caso.Cliente_mais_de_3_reclamacoes__c}" id="checkbox5" disabled="true"/>
                                                                <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox5">
                                                                    <span class="slds-checkbox--faux"></span>_Cliente com mais do que três reclamações nos últimos três meses
                                                                </apex:outputLabel>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!----------------------------------------------------------------------------------------------------------------------------------------------------->
                                        <!----------------------------------------------------------------------------------------------------------------------------------------------------->
                                        <!--------------------------------------------------ALERTAS DAS LINHAS DA RECLAMAÇÃO------------------------------------------------------------------->
                                        <!----------------------------------------------------------------------------------------------------------------------------------------------------->
                                        <!----------------------------------------------------------------------------------------------------------------------------------------------------->
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <script>
                                                    var currentRecord = 0;
                                                    function moveForward(){
                                                        if(currentRecord == 0){
                                                            var backBtt = document.getElementById("liBack");
                                                            backBtt.classList.remove("slds-hide");
                                                        }
                                                        if((currentRecord + {!maxLines}) < {!items.size}){
                                                            currentRecord++;
                                                        }
                                                        if((currentRecord + {!maxLines}) == {!items.size}){
                                                            var nextBtt = document.getElementById("liNext");
                                                            nextBtt.classList.add("slds-hide");
                                                        }
                                                        var firstEle = document.getElementById("li" + currentRecord);
                                                        firstEle.classList.add("slds-hide");
                                                        var aux = (currentRecord + {!maxLines});
                                                        //console.log(aux);
                                                        var lastEle = document.getElementById("li" + aux);
                                                        lastEle.classList.remove("slds-hide");
                                                    }
                                                    
                                                    function moveBackward(){
                                                        if((currentRecord + {!maxLines}) == {!items.size}){
                                                            var nextBtt = document.getElementById("liNext");
                                                            nextBtt.classList.remove("slds-hide");
                                                        }
                                                        if(currentRecord > 0){
                                                            currentRecord--;
                                                        }
                                                        if(currentRecord == 0){
                                                            var backBtt = document.getElementById("liBack");
                                                            backBtt.classList.add("slds-hide");
                                                        }
                                                        var firstEle = document.getElementById("li" + (currentRecord + 1));
                                                        firstEle.classList.remove("slds-hide");
                                                        var aux = ((currentRecord + 1) + {!maxLines});
                                                        //console.log(aux);
                                                        var lastEle = document.getElementById("li" + aux);
                                                        lastEle.classList.add("slds-hide");
                                                    }
                                                    </script>
                                                    <div class="slds-tabs_default">
                                                        <ul class="slds-tabs_default__nav" role="tablist">
                                                            <apex:variable id="index" value="{!0}" var="index"/>
                                                            <li class="slds-tabs_default__item slds-hide" title="Info" role="presentation" id="liBack">
                                                                <a class="slds-tabs_default__link slds-align--absolute-center" role="tab" tabindex="0" aria-selected="true" aria-controls="tab-default-0" 
                                                                   id="tab-default-0__item" onclick="moveBackward();">
                                                                    <svg class="slds-button__icon" aria-hidden="true">
                                                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevronleft')}" />
                                                                    </svg>
                                                                </a>
                                                            </li>
                                                            <apex:repeat value="{!items}" var="item">
                                                                <apex:variable id="index" value="{!index + 1}" var="index"/>
                                                                <li class="slds-tabs_default__item slds-size--1-of-12 slds-text-align--center {!If(index == 1,'slds-is-active','')} {!If(index <= maxLines,'','slds-hide')}" title="Info" 
                                                                    role="presentation" id="li{!index}">
                                                                    <a class="slds-tabs_default__link li{!index}" onclick="showTab(this);" role="tab" tabindex="{!index}" aria-selected="true" aria-controls="tab-default-{!index}" id="tab-default-{!index}__item">{!item.Referencia_Sku__c}</a></li>
                                                            </apex:repeat>
                                                            <li class="slds-tabs_default__item {!If(items.size > maxLines,'','slds-hide')}" title="Info" role="presentation" id="liNext">
                                                                <a class="slds-tabs_default__link slds-align--absolute-center" role="tab" tabindex="{!items.size}" aria-selected="true" aria-controls="tab-default-{!items.size}"
                                                                   id="tab-default-{!items.size}__item" onclick="moveForward();">
                                                                    <svg class="slds-button__icon" aria-hidden="true">
                                                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#chevronright')}" />
                                                                    </svg>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                        <apex:variable value="{!0}" var="index"/>
                                                        <apex:repeat value="{!items}" var="item">
                                                            <apex:variable id="index" value="{!index + 1}" var="index"/>
                                                            <div id="tab-default-{!index}" class="slds-tabs_default__content tab-default-{!index} {!If(index == 1,'slds-show','slds-hide')}" role="tabpanel" aria-labelledby="tab-default-{!index}__item">
                                                                
                                                                <div class="slds-form" role="list">
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Quantidade_Reclamada__c.Label}</span>
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        {!item.Quantidade_Reclamada__c}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Tipologia__c.Label}</span>
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        {!item.Tipologia__c}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Mercadoria_recebida_10_dias__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Mercadoria_recebida_10_dias__c}" id="checkbox1" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox1">
                                                                                                <span class="slds-checkbox--faux"></span>_Reclamação aberta sobre mercadoria entregue há mais de 10 dias
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Desvio_quantidade_inferior_1_neutro__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Desvio_quantidade_inferior_1_neutro__c}" id="checkbox2" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox2">
                                                                                                <span class="slds-checkbox--faux"></span>_Linha reclamada com desvio de quantidade inferir a 1% em produto neutro
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Desvio_quantidade_inferior_3_impresso__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Desvio_quantidade_inferior_3_impresso__c}" id="checkbox3" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox3">
                                                                                                <span class="slds-checkbox--faux"></span>_Linha reclamada com desvio de quantidade inferior a 3% em produto impresso
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Impressao_por_terceiros__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Impressao_por_terceiros__c}" id="checkbox4" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox4">
                                                                                                <span class="slds-checkbox--faux"></span>_Linha reclamada impressa por terceiros
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Produto_completo_reclamado_3_vezes__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Produto_completo_reclamado_3_vezes__c}" id="checkbox7" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox7">
                                                                                                <span class="slds-checkbox--faux"></span>_Produto/cor reclamado mais do que três vezes nos últimos três meses: {!item.N_de_reclamacoes_produto_completo__c}
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Produto_base_reclamado_3_vezes__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Produto_base_reclamado_3_vezes__c}" id="checkbox6" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox6">
                                                                                                <span class="slds-checkbox--faux"></span>Produto base reclamado mais do que três vezes nos últimos três meses: {!item.N_de_reclamacoes_produto_base__c}
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent {!if(item.Produto_bloqueado_Controlo_de_Qualidade__c , 'slds-has-error', '')}">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        <span class="slds-checkbox">
                                                                                            <apex:inputCheckbox value="{!item.Produto_bloqueado_Controlo_de_Qualidade__c}" id="checkbox5" disabled="true"/>
                                                                                            <apex:outputLabel styleClass="slds-checkbox__label" for="checkbox5">
                                                                                                <span class="slds-checkbox--faux"></span>_Produto bloqueado por controlo de qualidade
                                                                                            </apex:outputLabel>
                                                                                        </span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-gutters_small">
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        _Número de dossiers para o cliente com o mesmo artigo nos últimos dois meses: {!item.N_dossiers_cliente_mesmo_artigo__c}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                                                <div class="slds-form-element__control">
                                                                                    <span class="slds-form-element__static slds-border_bottom">
                                                                                        _Número de dossiers de amostra do cliente com o mesmo artigo: {!item.N_dossiers_amostra_cliente_mesmo_artigo__c}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </apex:repeat>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div><!--FORM-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!---------------------------------------------------SIMULADOR----------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <!----------------------------------------------------------------------------------------------------------------------------->
                    <div class="slds-form-element__row">
                        <div class="slds-form-element slds-size_1-of-1">
                            <div class="slds-section">
                                <h3 class="slds-section__title">
                                    <a aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action" onclick="changeSection(this, this.parentElement.parentElement);">
                                        <span class="slds-truncate" style="width: 100%; text-align: left;">
                                            <div class="slds-icon_container slds-m-right--medium">
                                                <svg class="slds-section__title-action-icon slds-button__icon" aria-hidden="false">
                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#switch')}"></use>
                                                </svg>
                                            </div>
                                            _Simulação de custos
                                        </span>
                                    </a>
                                </h3>
                                <div aria-hidden="true" class="slds-section__content" id="expando-unique-id">
                                    <apex:outputPanel id="simuladorPanel">
                                        <div class="slds-form" role="list">
                                            <div class="slds-grid slds-gutters_small">
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            <span style="font-weight:bold;" class="slds-form-element__label slds-text-heading--label">_Cliente</span>
                                                            <div class="slds-form-element__control">
                                                                <apex:outputPanel rendered="{!caso.Cobrar_portes_ao_cliente__c}">
                                                                    <apex:outputText value="{0,number,#,###########0.00}">
                                                                        <apex:param value="{!custosTransp}"/>
                                                                    </apex:outputText>{!currencySymbol}
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!!caso.Cobrar_portes_ao_cliente__c}">
                                                                    0.00€
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            <span style="font-weight:bold;" class="slds-form-element__label slds-text-heading--label">_Paul Stricker</span>
                                                            <div class="slds-form-element__control">
                                                                <apex:outputPanel rendered="{!caso.Cobrar_portes_ao_cliente__c}">
                                                                    0.00€
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!!caso.Cobrar_portes_ao_cliente__c}">
                                                                    <apex:outputText value="{0,number,#,###########0.00}">
                                                                        <apex:param value="{!custosTransp}"/>
                                                                    </apex:outputText>{!currencySymbol}
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                    <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                        <div class="slds-form-element__control">
                                                            <span style="font-weight:bold;" class="slds-form-element__label slds-text-heading--label">_Outras responsabilidades</span>
                                                            <div class="slds-form-element__control">
                                                                <apex:outputText value="{0,number,#,###########0.00}">
                                                                    <apex:param value="{!outrasResp}"/>
                                                                </apex:outputText>{!currencySymbol}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!-------------------------------------------------------- MODAL EDIT LINHAS -------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="linhas">
                <div class="slds-modal__container" style="width: auto;max-width: 95%;min-width: 80%;">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="closeModal('linhas')" type="button">
                                <div class="slds-icon_container slds-icon-utility-close">
                                    <svg class="slds-icon" aria-hidden="false">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </div>
                            </button>
                            <h2 class="slds-text-heading--medium">_Linhas da reclamação</h2>
                        </h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        
                        <apex:outputPanel id="editPanel">
                            <apex:outputPanel rendered="{!!showTratamento}">
                                <div class="slds-form-element__row">
                                    <div class="slds-form-element slds-size--1-of-1">
                                        <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error slds-hide" id="alertasErros" role="alert">
                                            <h2 id="alertasErrosMensagem">
                                            </h2>
                                        </div>
                                    </div>
                                </div>
                                <table class="slds-table slds-table_bordered slds-table_cell-buffer reduceFont">
                                    <thead>
                                        <tr>
                                            <th>
                                                {!$Label.Referencia}
                                            </th>
                                            <th width="1%">
                                                _Qtt total
                                            </th>
                                            <th width="5%">
                                                {!$Label.Quantidade}
                                            </th>
                                            <th>
                                                {!$ObjectType.OrderItem.fields.Tipologia__c.Label}
                                            </th>
                                            <th class="subHeader">
                                                {!$ObjectType.OrderItem.fields.Sub_tipologia__c.Label}
                                            </th>
                                            <th class="infoHeader" width="15%">
                                                {!$Label.Outras_informacoes}
                                            </th>
                                            <th class="{!if(hasComentType, '', 'slds-hide')}">
                                                {!$ObjectType.OrderItem.fields.Comentario_do_cliente__c.Label}
                                            </th>
                                            <th class="{!if(hasComentType, '', 'slds-hide')}">
                                                _Tradução do cliente
                                            </th>
                                            <th class="actionHeader">
                                                {!$ObjectType.OrderItem.fields.Acao_corretiva__c.Label}
                                            </th>
                                            <th class="originHeader">
                                                {!$ObjectType.OrderItem.fields.Departamento_de_origem__c.Label}
                                            </th>
                                            <th class="attachHeader">
                                                {!$Label.Anexos}
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:variable value="{!caso.Status = 'Aberta' || isAllowed}" var="editable"/>
                                        <apex:repeat value="{!items}" var="linha">
                                            <tr>
                                                <td>
                                                    <apex:outputField value="{!linha.Referencia_SKU__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!linha.Quantidade_original__c}"/>
                                                </td>
                                                <td>
                                                    <apex:inputField value="{!linha.Quantidade_reclamada__c}" styleClass="slds-input" rendered="{!editable}"/>
                                                    <apex:outputField value="{!linha.Quantidade_reclamada__c}" rendered="{!!editable}"/>
                                                </td>
                                                <td>
                                                    <apex:inputField value="{!linha.Tipologia__c}" styleClass="slds-input {!linha.Id}tipo" rendered="{!editable}" onchange="spinnerOn(true);dummyPicklist();"/>
                                                    <span class="{!linha.Id}tipo {!if(!editable, '', 'slds-hide')}">{!linha.Tipologia__c}</span>
                                                </td>
                                                <td class="subCell">
                                                    <apex:outputPanel rendered="{!editable}">
                                                        <select class="slds-input sub{!linha.Id}" size="1" onchange="document.getElementsByClassName('subPicklistHidden{!linha.Id}')[0].children[0].children[0].value = this.value;">
                                                            <option value="">-- Nenhum --</option>
                                                        </select> 
                                                        <div class="subPicklistHidden slds-hide subPicklistHidden{!linha.Id}" thisLine="{!linha.Id}">
                                                            <apex:inputField value="{!linha.Sub_tipologia__c}"/>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!!editable}">
                                                        <apex:outputField value="{!linha.Sub_tipologia__c}"/>
                                                    </apex:outputPanel>
                                                </td>
                                                <td class="extraInfoLine slds-hide" thisLine="{!linha.Id}">
                                                    <div class="slds-m-left--medium">
                                                        <!-- {linha.Id}ImpTer => JS:show/hideExtraInfo(); = sabe que painel mostrar para a linha (linha.Id) correspondente com a ajuda do mapeamento feito na variavel map(tipologia, valores a mostrar) -->
                                                        <!-- extraPanels => JS:hideExtraInfo() -->
                                                        <div class="{!linha.Id}ImpTer slds-hide extraPanels">
                                                            <div class="slds-form-element__row">
                                                                <div class="slds-form-element__control">
                                                                    <span class="slds-checkbox">
                                                                        <apex:inputCheckbox value="{!linha.Impressao_por_terceiros__c}" id="checkboxRefRecErrada" disabled="{!!editable}"/>
                                                                        <apex:outputLabel styleClass="slds-checkbox__label" for="checkboxRefRecErrada">{!$ObjectType.OrderItem.fields.Impressao_por_terceiros__c.Label}?
                                                                            <span class="slds-checkbox--faux"></span>
                                                                        </apex:outputLabel>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- {linha.Id}ImpTer => JS:show/hideExtraInfo(); -->
                                                        <div class="{!linha.Id}PrecInc slds-hide extraPanels">
                                                            <div class="slds-form-element__row">
                                                                <apex:outputLabel styleClass="" for="precoErroPreco">{!$ObjectType.OrderItem.fields.Preco_correto__c.Label}:&nbsp;
                                                                </apex:outputLabel>
                                                            </div>
                                                            <div class="slds-form-element__row">
                                                                <!-- {linha.Id}PrecIncInput => JS:validateInputs() -->
                                                                <apex:inputField id="precoErroPreco" value="{!linha.Preco_correto__c}" rendered="{!editable}" styleClass="slds-input slds-size_1-of-1 {!linha.Id}PrecIncInput"/>
                                                                <apex:outputField value="{!linha.Preco_correto__c}" rendered="{!!editable}" styleClass="slds-size_1-of-1"/>
                                                            </div>
                                                        </div>
                                                        <!-- {linha.Id}IvaInc => JS:show/hideExtraInfo(); -->
                                                        <div class="{!linha.Id}IvaInc slds-hide extraPanels">
                                                            <div class="slds-form-element__row">
                                                                <apex:outputLabel styleClass="" for="precoErroIVA">{!$Objecttype.OrderItem.fields.IVA_correto__c.Label}:&nbsp;
                                                                </apex:outputLabel>
                                                            </div>
                                                            <div class="slds-form-element__row">
                                                                <!-- {linha.Id}IvaIncInput => JS:validateInputs() -->
                                                                <apex:inputField id="precoErroIVA" value="{!linha.IVA_correto__c}" rendered="{!editable}" styleClass="slds-input slds-size_1-of-1 {!linha.Id}IvaIncInput"/>
                                                                <apex:outputField value="{!linha.IVA_correto__c}" rendered="{!!editable}" styleClass="slds-size_1-of-1"/>
                                                            </div>
                                                        </div>
                                                        <!-- {linha.Id}Mor => JS:show/hideExtraInfo(); -->
                                                        <div class="{!linha.Id}Mor slds-hide extraPanels">
                                                            <div class="slds-form-element__row">
                                                                
                                                                <apex:outputLabel styleClass="" for="dataRefRecErrada">
                                                                    {!$ObjectType.OrderItem.fields.Morada_correta__c.Label}:&nbsp;
                                                                </apex:outputLabel>
                                                            </div>
                                                            <div class="slds-form-element__row">
                                                                <apex:outputPanel rendered="{!editable}">
                                                                    <div class="slds-form-element slds-size--4-of-5">
                                                                        <!--morada{linha.Id} => moradasModal--><!--{linha.Id}MorInput => JS:validateInputs()-->
                                                                        <input style="background-color: rgb(236, 235, 234) !important;" class="slds-input morada{!linha.Id} {!linha.Id}MorInput" disabled="true" value="{!linha.Rua_Correta__c}"/>
                                                                        <!--moradaHidden{linha.Id} => moradasModal-->
                                                                        <apex:inputText styleClass="moradaHidden{!linha.Id} slds-hide" value="{!linha.Morada_correta__c}"/>
                                                                        <!--moradaRuaHidden{linha.Id} => moradasModal-->
                                                                        <apex:inputText styleClass="moradaRuaHidden{!linha.Id} slds-hide" value="{!linha.Rua_Correta__c}"/>
                                                                        <!--moradaMseqHidden{linha.Id} => moradasModal-->
                                                                        <apex:inputText styleClass="moradaMseqHidden{!linha.Id} slds-hide" value="{!linha.MSEQ_Morada_correta__c}"/>
                                                                    </div>
                                                                    
                                                                    <div class="slds-form-element slds-size--1-of-12" style="padding-left:0;">
                                                                        <!--search{linha.Id} => JS:renderSearch()-->
                                                                        <span id="search{!linha.Id}" class="lookIcon slds-align--absolute-center" onclick="spinnerOn(true);callMoradas('{!linha.Id}');">
                                                                            <!-- AQUI É CRIADO O BOTÃO COM O ICON -->
                                                                        </span>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!!editable}">
                                                                    <apex:outputField value="{!linha.Rua_Correta__c}" styleClass="slds-size_1-of-1"/>
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                        <!-- {linha.Id}DataRec => JS:show/hideExtraInfo(); -->
                                                        <div class="{!linha.Id}DataRec slds-hide extraPanels">
                                                            <div class="slds-m-top--small">
                                                                <div class="slds-form-element__row">
                                                                    
                                                                    <apex:outputLabel styleClass="" for="dataRefRecErrada">{!$Label.Data_de_recepcao}:&nbsp;
                                                                    </apex:outputLabel>
                                                                </div>
                                                                <div class="slds-form-element__row">
                                                                    <!-- {linha.Id}DataRecInput => JS:validateInputs() -->
                                                                    <apex:inputField id="dataRefRecErrada" value="{!linha.Data_de_rececao_dos_artigos_reclamados__c}" rendered="{!editable}" html-autocomplete="off" 
                                                                                     styleClass="slds-input slds-size_1-of-1 {!linha.Id}DataRecInput"/>
                                                                    <apex:outputField value="{!linha.Data_de_rececao_dos_artigos_reclamados__c}" rendered="{!!editable}" styleClass="slds-size_1-of-1"/>
                                                                    <div id="auxDate{!linha.Id}" recData="{!linha.Data_de_emissao_do_documento_financeiro__c}" style="display:none;"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                </td>
                                                <td class="{!if(hasComentType, '', 'slds-hide')}">
                                                    <apex:inputField value="{!linha.Comentario_do_cliente__c}" html-disabled="true" styleClass="slds-textarea"/>
                                                </td>
                                                <td class="{!if(hasComentType, '', 'slds-hide')}">
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!linha.Comentario_do_cliente_traducao__c}" styleClass="slds-textarea"/>
                                                    </div>
                                                </td>
                                                <td class="actionCell">
                                                    <apex:outputPanel rendered="{!editable}">
                                                        
                                                        <select class="slds-input action{!linha.Id} actionField" size="1" matchEle="actionPicklistHidden{!linha.Id}" onchange="document.getElementsByClassName('actionPicklistHidden{!linha.Id}')[0].children[0].children[0].value = this.value;">
                                                            <option value="">-- Nenhum --</option>
                                                        </select>
                                                        
                                                        <div class="actionPicklistHidden slds-hide actionPicklistHidden{!linha.Id}" thisLine="{!linha.Id}">
                                                            <apex:inputField rendered="{!isAllowed}" value="{!linha.Acao_corretiva__c}" styleClass="slds-input "/>
                                                            <apex:inputField rendered="{!!isAllowed}" value="{!linha.Acao_corretiva_sugerida__c}" styleClass="slds-input "/>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!!editable}">
                                                        <apex:outputField value="{!linha.Acao_corretiva__c}"/>
                                                    </apex:outputPanel>
                                                </td>
                                                <td class="originCell">
                                                    <apex:outputPanel rendered="{!editable}">
                                                        <select class="slds-input origin{!linha.Id}" size="1" onchange="document.getElementsByClassName('originPicklistHidden{!linha.Id}')[0].children[0].children[0].value = this.value;">
                                                            <option value="" >-- Nenhum --</option>
                                                        </select> 
                                                        <div class="originPicklistHidden slds-hide originPicklistHidden{!linha.Id}" thisLine="{!linha.Id}">
                                                            <apex:inputField value="{!linha.Departamento_de_origem__c}" styleClass="slds-input"/>
                                                        </div>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!!editable}">
                                                        <apex:outputField value="{!linha.Departamento_de_origem__c}" styleClass="slds-size_1-of-1"/>
                                                    </apex:outputPanel>
                                                </td>
                                                <td>
                                                    <div class="slds-form-element__control">
                                                        <div class="slds-form-element__row" style="margin-bottom:0;">
                                                            <button class="slds-button slds-button--neutral fileBtt{!linha.Id} slds-input" onclick="spinnerOn(true);chooseLine('{!linha.Id}');" type="button">{!$Label.Carregar}</button>
                                                        </div>
                                                        <div class="slds-form-element__row" style="margin-bottom:0;">
                                                            <span id="auxDiv{!linha.Id}" class="slds-badge"></span>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                                <apex:outputPanel id="comLinePanel">
                                    <apex:outputPanel rendered="{!hasComLine}">
                                        <table class="slds-table slds-table_bordered slds-table_cell-buffer reduceFont slds-size--1-of-4 slds-m-top--small">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        {!$Label.Referencia}
                                                    </th>
                                                    <th>
                                                        {!$ObjectType.OrderItem.fields.UnitPrice.Label}
                                                    </th>
                                                    <th>
                                                        &nbsp;
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        {!comLine.Referencia_Sku__c}
                                                    </td>
                                                    <td>
                                                        
                                                        <apex:inputField value="{!comLine.UnitPrice}" styleClass="slds-input"/>
                                                    </td>
                                                    <td>
                                                        <span id="deleteIcon" class="deleteIcon slds-align--absolute-center slds-input slds-button--neutral" onclick="spinnerOn(true);deleteComLine();" 
                                                              style="width: auto; padding-right: 0.5rem; padding-left: 0.5rem; height: 32px; vertical-align: bottom; cursor: pointer;">
                                                            <!-- AQUI É CRIADO O BOTÃO COM O ICON -->
                                                            <svg class="slds-icon slds-icon-text-default" style="width: 15px;height:15px;">
                                                                <use xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#delete')}"></use>
                                                            </svg>
                                                        </span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <apex:actionFunction name="createComLine" action="{!createComLine}" rerender="comLinePanel, lineFooterPanel" oncomplete="renderDel();spinnerOn(false);"/>
                        <apex:actionFunction name="deleteComLine" action="{!deleteComLine}" rerender="comLinePanel, lineFooterPanel" oncomplete="renderDel();spinnerOn(false);"/>
                        <apex:outputPanel id="lineFooterPanel" styleClass="slds-float--left">
                            <a class="slds-button slds-button_neutral {!if(hasComLine, 'slds-hide' ,'')}" onclick="spinnerOn(true);createComLine();">_Inserir Linha Crédito</a>
                        </apex:outputPanel>

                        <a class="slds-button slds-button_success {!if(And(caso.Status == 'Em análise', editable), '' ,'slds-hide')}" style="color:white;" onclick="spinnerOn(true);validarAcoes();">_Enviar para tratamento</a>

                        <a class="slds-button slds-button_brand" onclick="saveFiles();gravarLinhasJS();spinnerOn(true)">{!$Label.Gravar}</a>
                    </div>
                </div>
            </div>
            
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!------------------------------------------------------ MODAL CRIAR PARECER -------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="createOpinion">
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="closeModal('createOpinion')" type="button">
                                <div class="slds-icon_container slds-icon-utility-close">
                                    <svg class="slds-icon" aria-hidden="false">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </div>
                            </button>
                            <h2 class="slds-text-heading--medium">Pedir parecer</h2>
                            <p class="slds-m-top_x-small">
                            </p>
                        </h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <apex:outputPanel id="createOpinionModal">
                            <apex:inputField value="{!pedidoDummy.Tipologia__c}" styleClass="slds-hide"/>
                            <apex:inputField value="{!pedidoDummy.Departamento__c}" styleClass="departHidden slds-hide"/>
                            <div id="buildListDiv" existingDeps="{!existingDeparts}">
                                <!-- AQUI É CONSTRUIDA A LISTA DOS DEPARTAMENTOS POSSIVEIS DE PEDIR PARECER buildList() -->
                            </div>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <a class="slds-button slds-button_brand" onclick="spinnerOn(true);criarParecerJS();">{!$Label.Submeter}</a>
                    </div>
                </div>
            </div>
            
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!------------------------------------------------------ MODAL UPLOAD FILES --------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="filesModal">
                <div class="slds-modal__container" style="width: auto;max-width: max-content;">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">{!$Label.Ficheiros_carregados}</h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <div class="slds-form-element__row">
                            <div class="slds-form-element">
                                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_warning" style="border-radius: 0.2rem; color:black;" role="alert">
                                    <h2 class="reduceFont">
                                        {!$Label.Nao_poder_carregar_ficheiros}
                                    </h2>
                                </div>
                            </div>
                        </div>
                        <apex:outputPanel id="filesModalContent">
                            <div class="slds-form-element__row slds-m-vertical--small slds-m-left--small">
                                <div class="slds-form-element">
                                    <div class="slds-file-selector slds-file-selector_files">
                                        <input type="file" class="slds-file-selector__input slds-assistive-text" id="file-upload-input-01" accept=".jpg,.png,.gif,.pdf,.mp4,.mov,.flv,.avi"
                                               aria-labelledby="file-selector-primary-label file-selector-secondary-label" onchange="readFile('{!lineUniqueId}');"/>
                                        <label class="slds-file-selector__body" for="file-upload-input-01" id="file-selector-secondary-label">
                                            <span class="slds-file-selector__button slds-button slds-button_neutral">{!$Label.Carregar}</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-form-element__row slds-scrollable">
                                <div class="slds-form-element" id="filesTable">
                                    <!-- AQUI É CRIADA A TABELA COM A LISTA DOS FICHEIROS JÁ ADICIONADOS PARA ESTA LINHA -->
                                </div>
                            </div>
                            
                            <script>
                            function buildFilesTable(){
                                j$("#filesTable").empty();
                                
                                if("{!lineUniqueId}" in filesMap){
                                    if(filesMap["{!lineUniqueId}"].length > 0){
                                        var table = j$('<table/>', {
                                            class: 'slds-table slds-table_bordered slds-table_cell-buffer',
                                        });
                                        table.append(buildTableHeader());
                                        var aux = filesMap["{!lineUniqueId}"];
                                        for(var i = 0; i < aux.length; i++){
                                            var tr = j$("<tr/>", {});
                                            var td1 = j$("<td>" + aux[i].name + "</td>", {});
                                            var td2 = j$("<td>" + aux[i].extension + "</td>", {});
                                            var td3 = j$("<td/>", {});
                                            var bttString = j$("<a/>", {
                                                class: "slds-button slds-button--neutral",
                                                html: "{!$Label.Apagar}",
                                                index: i,
                                            });
                                            j$(bttString).attr("onclick", "removeFileFromMap(" + i + ", '{!lineUniqueId}');");//console.log('{!lineUniqueId}'+"+ i +");
                                            
                                            //arranjar um separador para poder apagar no mapa, o indice correcto.
                                            td3.append(bttString);
                                            tr.append(td1);
                                            tr.append(td2);
                                            tr.append(td3);
                                            table.append(tr);
                                        }
                                    }
                                }
                                j$("#filesTable").prepend(table);
                                j$("#filesTable").html(j$("#filesTable").html());
                            }
                            </script>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button--destructive" onclick="closeModal('filesModal');openModal('linhas');" type="button">{!$Label.Fechar}</button>
                        
                    </div>
                </div>
            </div>
            
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!--------------------------------------------------- MODAL RESPONDER PEDIDO -------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="modal_resposta">
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="closeModal('modal_resposta')" type="button">
                                <div class="slds-icon_container slds-icon-utility-close">
                                    <svg class="slds-icon" aria-hidden="false">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </div>
                            </button>
                            <h2 class="slds-text-heading--medium">_Responder a  pedidos</h2>
                            <p class="slds-m-top_x-small">
                            </p>
                        </h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <apex:outputPanel id="respostaContent">
                            <apex:outputPanel rendered="{!choosenLine != ''}">
                                <apex:variable value="{!LinesMap}" var="line"/>
                                <apex:outputPanel rendered="{!mapaPedidos[choosenLine].fotos}">
                                    <div class="slds-form slds-m-bottom--x-large" role="list">
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-border_bottom">
                                                            <fieldset class="slds-form-element">
                                                                <legend class="slds-form-element__legend slds-form-element__label">{!$ObjectType.OrderItem.fields.Resposta_ao_pedido_de_fotos_adicionais__c.Label}:</legend>
                                                                <div class="slds-form-element__control">
                                                                    <div class="slds-radio_button-group">
                                                                        <apex:variable value="{!0}" var="index"/>
                                                                        <apex:repeat value="{!RespostasPedidoFotos}" var="options">
                                                                            <apex:variable value="{!index + 1}" var="index"/>
                                                                            <span class="slds-button slds-radio_button" style="white-space: nowrap;overflow: hidden;">
                                                                                <input type="radio" name="radio" id="radio{!index}" value="{!options.value}" class="radioResposta"/>
                                                                                <label class="slds-radio_button__label" for="radio{!index}">
                                                                                    <span class="slds-radio_faux">{!options.label}</span>
                                                                                </label>
                                                                            </span>
                                                                        </apex:repeat>
                                                                    </div>
                                                                </div>
                                                            </fieldset>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!mapaPedidos[choosenLine].recolha}">
                                    <div class="slds-form" role="list">
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Morada_de_pedido_de_recolha__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                             <apex:inputField value="{!line.Morada_de_pedido_de_recolha__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Destino_de_Mercadoria__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                            <apex:inputField value="{!line.Destino_de_Mercadoria__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Pais_da_recolha__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                             <apex:inputField value="{!line.Pais_da_recolha__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Telefone_logistico_de_recolha__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                            <apex:inputField value="{!line.Telefone_logistico_de_recolha__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Recolha_ao_cuidado_de__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                             <apex:inputField value="{!line.Recolha_ao_cuidado_de__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                                <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                    <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Tracking_Number_de_recolha__c.Label}</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">
                                                            <apex:inputField value="{!line.Tracking_Number_de_recolha__c}" styleClass="slds-input"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <a class="slds-button slds-button_brand" onclick="spinnerOn(true);responderPedidosJS();">_Responder</a>
                    </div>
                </div>
            </div>
            
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!--------------------------------------------------- MODAL ENVIAR TRATAMENTO ------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="modal_enviaTratamento">
                <div class="slds-modal__container" style="width: auto;max-width: 95%;min-width: 80%;">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="spinnerOn(true);dummyTratamentoClose();" type="button">
                                <div class="slds-icon_container slds-icon-utility-close">
                                    <svg class="slds-icon" aria-hidden="false">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </div>
                            </button>
                            <h2 class="slds-text-heading--medium">Enviar para tratamento</h2>
                            <p class="slds-m-top_x-small">
                            </p>
                        </h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <apex:outputPanel id="tratamentoContent">
                            
                            <apex:actionFunction name="dummyTratamentoClose" action="{!dummy}" rerender="editPanel,tratamentoContent,panelTotal" oncomplete="spinnerOn(false);closeModal('modal_enviaTratamento');">
                                <apex:param assignTo="{!showTratamento}" name="p1" value="{!!showTratamento}"/>
                            </apex:actionFunction>
                            <apex:outputPanel rendered="{!showTratamento}">
                                
                                <table class="slds-table slds-table_bordered slds-table_cell-buffer reduceFont">
                                    <thead>
                                        <tr>
                                            <th>
                                                {!$Label.Referencia}
                                            </th>
                                            <th>
                                                {!$ObjectType.OrderItem.fields.Quantidade_reclamada__c.Label}
                                            </th>
                                            <th>
                                                {!$ObjectType.OrderItem.fields.Tipologia__c.Label}
                                            </th>
                                            <th>
                                                {!$ObjectType.OrderItem.fields.Sub_tipologia__c.Label}
                                            </th>
                                            <th>
                                                {!$ObjectType.OrderItem.fields.Acao_corretiva__c.Label}
                                            </th>
                                            <th width="30%">
                                                {!$Label.Outras_informacoes}
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <apex:repeat value="{!items}" var="linha">
                                            <tr>
                                                <td>
                                                    <apex:outputField value="{!linha.Referencia_SKU__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!linha.Quantidade_reclamada__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!linha.Tipologia__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!linha.Sub_tipologia__c}"/>
                                                </td>
                                                <td>
                                                    <apex:outputField value="{!linha.Acao_corretiva__c}"/>
                                                </td>
                                                <td class="">
                                                    <fieldset class="slds-form--compound">
                                                        <div class="slds-form-element__group ">
                                                            <div class="slds-form-element__row">
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Correcção de preço'}">
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >{!$ObjectType.OrderItem.fields.Preco_correto__c.Label}:&nbsp;
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:inputField value="{!linha.Preco_correto__c}" styleClass="slds-input valor_creditar" 
                                                                                             onkeyup="calcValCred('{!linha.Id}', {!linha.Quantidade_reclamada__c}, this.value, {!linha.Preco_original__c});"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Correcção de IVA'}">
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >{!$ObjectType.OrderItem.fields.IVA_Correto__c.Label}:&nbsp;
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:inputField value="{!linha.IVA_correto__c}" styleClass="slds-input"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Dar desconto'}">
                                                                    
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Valor:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:inputField value="{!linha.Desconto_percentual__c}" styleClass="slds-input {!if(tipo[linha.Id] = 'percent', '', 'slds-hide')} percentDisc{!linha.Id}" 
                                                                                             html-placeholder="%" onchange="fillDiscount('{!linha.Id}', this.value, {!linha.Preco_total__c});"/>
                                                                            <apex:inputField value="{!linha.Desconto__c}" styleClass="slds-input {!if(tipo[linha.Id] = 'currency', '', 'slds-hide')} flatDisc{!linha.Id}" 
                                                                                             html-placeholder="{!currencySymbol}"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Devolução de mercadoria'}">
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Custo transportes (Devolução):
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputField value="{!linha.Portes_para_recolha_devolucao__c}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Custo de portes (Ida):
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputField value="{!linha.Custo_de_portes__c}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Handling:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputText value="{!handling}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Total custos transporte:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputText value="{!(linha.Portes_para_recolha_devolucao__c + custosTransp)}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Quantidade a recolher:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:inputField value="{!linha.Quantidade_a_recolher__c}" styleClass="slds-input"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                
                                                                
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Correcção de preço'}">
                                                                    <div class="slds-form-element slds-m-left--small">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel styleClass="" for="precoErroPreco">
                                                                                {!$ObjectType.OrderItem.fields.Valor_a_creditar__c.Label}:&nbsp;
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:inputField value="{!linha.Valor_a_creditar__c}" styleClass="slds-input valor_creditar{!linha.Id}"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Dar desconto'}">
                                                                    <div class="slds-form-element slds-m-left--small">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel styleClass="" for="precoErroPreco">
                                                                                Tipo:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:selectList value="{!tipo[linha.Id]}" size="1" styleClass="slds-input" onchange="changeDiscount('{!linha.Id}', this.value);">
                                                                                <apex:selectOption itemValue="percent" itemLabel="%"/>
                                                                                <apex:selectOption itemValue="currency" itemLabel="{!currencySymbol}"/>
                                                                            </apex:selectList>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel rendered="{!linha.Acao_corretiva__c = 'Devolução de mercadoria'}">
                                                                    <div class="slds-form-element slds-m-left--small">
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >{!$ObjectType.OrderItem.fields.Numero_de_caixas__c.Label}:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputField value="{!linha.Numero_de_caixas__c}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >{!$ObjectType.OrderItem.fields.Peso__c.Label}:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputField value="{!linha.Peso__c}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >{!$ObjectType.OrderItem.fields.Volume__c.Label}:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputField value="{!linha.Volume__c}"/>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputLabel >Responsabilidade de custos:
                                                                            </apex:outputLabel>
                                                                        </div>
                                                                        <div class="slds-form-element__row">
                                                                            <apex:outputText value="{!if(caso.Cobrar_portes_ao_cliente__c, 'Cliente', 'Paul Stricker')}"/>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputPanel>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                                
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <div class="slds-m-right--large" style="display: inline;">
                            <a class="slds-button slds-button_neutral" onclick="spinnerOn(true);recalcTotal();">Calcular total</a>
                            <apex:outputPanel id="panelTotal" styleClass="slds-p-horizontal--small">
                                
                                Total a creditar: <input type="text" value="{!totalCredito}" class="slds-input slds-size--1-of-12" onchange="spinnerOn(true);setValueTotal(this.value);"/>
                                <apex:actionFunction name="setValueTotal" action="{!dummy}" rerender="dummy" oncomplete="spinnerOn(false);">
                                    <apex:param assignTo="{!totalCredito}" name="p1" value=""/>
                                </apex:actionFunction>
                                <script>
                                function validateTotal(value){
                                    if( value > {!caso.Pedido__r.Total_da_fatura__c}){
                                        value = {!caso.Pedido__r.Total_da_fatura__c};
                                    }
                                    setValueTotal(value);
                                }
                                </script>
                            </apex:outputPanel>
                        </div>
                        <apex:actionFunction name="submeterTratamento" action="{!submeterTratamento}" rerender="dummy" oncomplete="spinnerOn(false);location.reload();"/>
                        <a class="slds-button slds-button_success" style="color:white;" onclick="spinnerOn(true);submeterTratamento();">Submeter</a>
                    </div>
                </div>
            </div>
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!-------------------------------------------------------- MODAL RECOLHA ------------------------------------------------------>
            <!----------------------------------------------------------------------------------------------------------------------------->
            <!----------------------------------------------------------------------------------------------------------------------------->
            <div class="slds-modal" aria-hidden="false" role="dialog" id="modal_recolha">
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h2 class="slds-text-heading--medium">
                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="closeModal('modal_recolha')" type="button">
                                <div class="slds-icon_container slds-icon-utility-close">
                                    <svg class="slds-icon" aria-hidden="false">
                                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS , '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </div>
                            </button>
                            <h2 class="slds-text-heading--medium">_Recolha</h2>
                            <p class="slds-m-top_x-small">
                            </p>
                        </h2>
                    </div>
                    <div class="slds-modal__content slds-p-around--medium">
                        <apex:outputPanel id="recolhaContent">
                            <apex:outputPanel rendered="{!choosenLine != ''}">
                                <apex:variable value="{!LinesMap}" var="lineRec"/>
                                <div class="slds-form" role="list">
                                    <div class="slds-grid slds-gutters_small">
                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Morada_de_pedido_de_recolha__c.Label}</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static">
                                                        <apex:inputField value="{!lineRec.Morada_de_pedido_de_devolucao__c}" styleClass="slds-input"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Pais_da_recolha__c.Label}</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static">
                                                        <apex:inputField value="{!lineRec.Pais_da_devolucao__c}" styleClass="slds-input"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters_small">
                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Telefone_logistico_de_recolha__c.Label}</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static">
                                                        <apex:inputField value="{!lineRec.Telefone_logistico_de_devolucao__c}" styleClass="slds-input"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Recolha_ao_cuidado_de__c.Label}</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static">
                                                        <apex:inputField value="{!lineRec.Devolucao_ao_cuidado_de__c}" styleClass="slds-input"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-grid slds-gutters_small">
                                        <div class="slds-col slds-has-flexi-truncate" role="listitem">
                                            <div class="slds-form-element slds-form-element_edit slds-hint-parent">
                                                <span class="slds-form-element__label">{!$ObjectType.OrderItem.Fields.Tracking_Number_de_recolha__c.Label}</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static">
                                                        <apex:inputField value="{!lineRec.Tracking_Number_de_devolucao__c}" styleClass="slds-input"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </div>
                    <div class="slds-modal__footer">
                        <a class="slds-button slds-button_brand" onclick="spinnerOn(true);responderRecolha();">_Responder</a>
                    </div>
                </div>
            </div>
        </apex:form>
        <div class="slds-spinner_container" style="display: none; position: fixed;" id="spinner">
            <div role="status" class="slds-spinner slds-spinner--medium">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
        <div class="slds-backdrop" id="backdrop"></div>
    </div>
</apex:page>